<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lake Cabin</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700;900&family=Lato:wght@400;700&display=swap"
    rel="stylesheet"
  />
  <style>
    * { font-family: 'Lato', sans-serif; }
    h1, h2, h3 { font-family: 'Merriweather', serif; }
  </style>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    function CabinScorer() {
      const criteria = [
        "Distance from Home", "Lake", "Lake Depth", "Frontage", "Beach",
        "Lake Bottom", "Swimming Depth", "Dock Condition", "Dock/Lift Included",
        "Backyard Slope", "Cabin Condition", "Bedrooms", "Bathrooms", "Kitchen",
        "Living Area", "Loft", "Fireplace", "Seasonal/Year Round", "Garage",
        "Outdoor Storage", "Backlot", "Lot size", "Lot side of Lake",
        "Included Furnishings/Toys"
      ];

      const weights = {
        "Distance from Home": 2,
        "Lake": 2,
        "Beach": 2,
        "Swimming Depth": 2,
        "Cabin Condition": 2,
        "Garage": 2,
        "Backlot": 2,
      };

      const guidelines = {
        "Distance from Home": "60 minutes",
        "Lake": "desirability",
        "Lake Depth": "25 feet",
        "Frontage": "50 feet",
        "Beach": "Sand",
        "Lake Bottom": "Hard",
        "Swimming Depth": "Three feet at Dock",
        "Backyard Slope": "Moderate",
        "Cabin Condition": "needs almost nothing",
        "Bedrooms": "Two",
        "Bathrooms": "One",
        "Lot side of Lake": "North, East",
      };

      const [cabins, setCabins] = useState([]);
      const [expanded, setExpanded] = useState(new Set());
      const [editingName, setEditingName] = useState(null);
      const [editingNumber, setEditingNumber] = useState(null);
      const [editingPrice, setEditingPrice] = useState(null);

      useEffect(() => {
        const s = localStorage.getItem('cabinData');
        if (s) {
          try {
            const d = JSON.parse(s);
            if (d.cabins) {
              const u = d.cabins.map(c => {
                const sc = {};
                criteria.forEach(cr => {
                  sc[cr] = c.scores && c.scores[cr] !== undefined ? c.scores[cr] : 0;
                });
                return {
                  id: c.id,
                  name: c.name,
                  number: c.number || '',
                  price: c.price || '',
                  scores: sc
                };
              });
              setCabins(u);
            }
          } catch (e) {}
        }
      }, []);

      useEffect(() => {
        if (cabins.length > 0) {
          localStorage.setItem('cabinData', JSON.stringify({ cabins }));
        }
      }, [cabins]);

      const addCabin = () => {
        const sc = {};
        criteria.forEach(c => { sc[c] = 0; });
        setCabins([
          ...cabins,
          {
            id: Date.now(),
            name: `Cabin ${cabins.length + 1}`,
            number: '',
            price: '',
            scores: sc
          }
        ]);
      };

      const removeCabin = (id) => {
        if (window.confirm('Delete this cabin?')) {
          setCabins(cabins.filter(c => c.id !== id));
        }
      };

      const updateName   = (id, name)   => setCabins(cabins.map(c => c.id === id ? { ...c, name }   : c));
      const updateNumber = (id, number) => setCabins(cabins.map(c => c.id === id ? { ...c, number } : c));
      const updatePrice  = (id, price)  => setCabins(cabins.map(c => c.id === id ? { ...c, price }  : c));

      const updateScore = (cid, cr, sc) =>
        setCabins(cabins.map(c =>
          c.id === cid ? { ...c, scores: { ...c.scores, [cr]: sc } } : c
        ));

      const calculateTotal = (c) => {
        let t = 0;
        for (const cr in c.scores) {
          t += (c.scores[cr] || 0) * (weights[cr] || 1);
        }
        return t;
      };

      const getScoreColor = (s) =>
        ({
          '-2': 'bg-red-500 hover:bg-red-600',
          '-1': 'bg-red-300 hover:bg-red-400',
          '0':  'bg-yellow-400 hover:bg-yellow-500',
          '1':  'bg-green-300 hover:bg-green-400',
          '2':  'bg-green-500 hover:bg-green-600',
        }[String(s)] || 'bg-yellow-400 hover:bg-yellow-500');

      const toggleExpanded = (id) => {
        setExpanded(prev => {
          const n = new Set(prev);
          if (n.has(id)) n.delete(id);
          else n.add(id);
          return n;
        });
      };

      const exportData = () => {
        const blob = new Blob([JSON.stringify({ cabins }, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link =
