<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lake Cabin Scorer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700;900&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        * { font-family: 'Lato', sans-serif; }
        h1, h2, h3 { font-family: 'Merriweather', serif; }
        .transition-all { transition: all 0.2s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function CabinScorer() {
            const criteria = ["Distance from Home", "Lake", "Lake Depth", "Frontage", "Beach", "Lake Bottom", "Swimming Depth", "Dock Condition", "Dock/Lift Included", "Backyard Slope", "Cabin Condition", "Bedrooms", "Bathrooms", "Kitchen", "Living Area", "Loft", "Fireplace", "Seasonal/Year Round", "Garage", "Outdoor Storage", "Backlot", "Lot size", "Lot side of Lake", "Included Furnishings/Toys"];
            const weights = { "Distance from Home": 2, "Lake": 2, "Beach": 2, "Swimming Depth": 2, "Cabin Condition": 2, "Garage": 2, "Backlot": 2 };
            const guidelines = { "Distance from Home": "60 minutes", "Lake": "desirability", "Lake Depth": "25 feet", "Frontage": "50 feet", "Beach": "Sand", "Lake Bottom": "Hard", "Swimming Depth": "Three feet at Dock", "Backyard Slope": "Moderate", "Cabin Condition": "needs almost nothing", "Bedrooms": "Two", "Bathrooms": "One", "Lot side of Lake": "North, East" };
            
            const [cabins, setCabins] = useState([]);
            const [expanded, setExpanded] = useState(new Set());
            const [editingName, setEditingName] = useState(null);
            const [editingNumber, setEditingNumber] = useState(null);
            const [editingPrice, setEditingPrice] = useState(null);

            // Initialize Lucide icons whenever the DOM updates
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            });

            useEffect(() => {
                const saved = localStorage.getItem('cabinData');
                if (saved) {
                    try {
                        const parsed = JSON.parse(saved);
                        if (parsed.cabins) setCabins(parsed.cabins);
                    } catch (e) { console.error("Load error", e); }
                }
            }, []);

            useEffect(() => {
                localStorage.setItem('cabinData', JSON.stringify({ cabins }));
            }, [cabins]);

            const addCabin = () => {
                const newScores = {};
                criteria.forEach(c => newScores[c] = 0);
                setCabins([...cabins, { id: Date.now(), name: `Cabin ${cabins.length + 1}`, number: '', price: '', scores: newScores }]);
            };

            const removeCabin = (id) => {
                if (window.confirm('Delete this cabin?')) setCabins(cabins.filter(c => c.id !== id));
            };

            const updateScore = (cid, cr, sc) => {
                setCabins(cabins.map(c => c.id === cid ? { ...c, scores: { ...c.scores, [cr]: sc } } : c));
            };

            const calculateTotal = (c) => {
                return Object.entries(c.scores).reduce((acc, [key, val]) => acc + (val * (weights[key] || 1)), 0);
            };

            const toggleExpanded = (id) => {
                const n = new Set(expanded);
                if (n.has(id)) n.delete(id); else n.add(id);
                setExpanded(n);
            };

            const getScoreColor = (s) => ({
                '-2': 'bg-red-500 hover:bg-red-600',
                '-1': 'bg-red-300 hover:bg-red-400',
                '0': 'bg-yellow-400 hover:bg-yellow-500',
                '1': 'bg-green-300 hover:bg-green-400',
                '2': 'bg-green-500 hover:bg-green-600'
            }[s]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-teal-50 p-4 md:p-8">
                    <div className="max-w-4xl mx-auto">
                        <header className="text-center mb-10">
                            <h1 className="text-5xl font-black text-slate-800 mb-2">Lake Cabin</h1>
                            <p className="text-slate-600">Compare and score potential properties</p>
                        </header>

                        <button onClick={addCabin} className="w-full mb-8 py-4 bg-teal-600 text-white rounded-xl hover:bg-teal-700 shadow-lg flex items-center justify-center gap-2 font-bold text-lg transition-all">
                            <i data-lucide="plus-circle"></i> Add New Cabin
                        </button>

                        <div className="space-y-6">
                            {cabins.sort((a,b) => calculateTotal(b) - calculateTotal(a)).map(cabin => {
                                const total = calculateTotal(cabin);
                                const isExpanded = expanded.has(cabin.id);

                                return (
                                    <div key={cabin.id} className="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                                        <div className="p-6 bg-gradient-to-r from-slate-800 to-slate-700 text-white">
                                            <div className="flex justify-between items-start mb-4">
                                                <div className="flex-1">
                                                    {editingName === cabin.id ? (
                                                        <input 
                                                            className="text-2xl font-bold bg-white text-slate-900 rounded px-2 w-full"
                                                            value={cabin.name} 
                                                            autoFocus
                                                            onBlur={() => setEditingName(null)}
                                                            onChange={(e) => setCabins(cabins.map(c => c.id === cabin.id ? {...c, name: e.target.value} : c))}
                                                        />
                                                    ) : (
                                                        <h2 className="text-2xl font-bold flex items-center gap-2 cursor-pointer" onClick={() => setEditingName(cabin.id)}>
                                                            {cabin.name} <i data-lucide="edit-3" className="w-4 h-4 opacity-50"></i>
                                                        </h2>
                                                    )}
                                                    <p className="text-teal-200 font-mono mt-1">{cabin.number || 'No Address'}</p>
                                                </div>
                                                <div className="text-right">
                                                    <div className="text-sm uppercase tracking-wider opacity-70">Total Score</div>
                                                    <div className="text-4xl font-black text-teal-300">{total > 0 ? `+${total}` : total}</div>
                                                </div>
                                            </div>
                                            
                                            <div className="flex justify-between items-center mt-6">
                                                <button onClick={() => removeCabin(cabin.id)} className="text-red-300 hover:text-red-100 text-sm flex items-center gap-1">
                                                    <i data-lucide="trash-2" className="w-4 h-4"></i> Remove
                                                </button>
                                                <button onClick={() => toggleExpanded(cabin.id)} className="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg flex items-center gap-2 transition-all">
                                                    {isExpanded ? 'Hide Details' : 'Show Criteria'}
                                                    <i data-lucide={isExpanded ? "chevron-up" : "chevron-down"}></i>
                                                </button>
                                            </div>
                                        </div>

                                        {isExpanded && (
                                            <div className="p-6 space-y-4 bg-slate-50">
                                                {criteria.map(crit => (
                                                    <div key={crit} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100">
                                                        <div className="flex justify-between mb-3">
                                                            <div>
                                                                <span className="font-bold text-slate-700">{crit}</span>
                                                                {weights[crit] && <span className="ml-2 text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full font-bold">Value Ã—{weights[crit]}</span>}
                                                                {guidelines[crit] && <p className="text-xs text-slate-400 italic">{guidelines[crit]}</p>}
                                                            </div>
                                                            <div className="font-black text-slate-400">
                                                                {(cabin.scores[crit] * (weights[crit] || 1)) > 0 ? '+' : ''}{cabin.scores[crit] * (weights[crit] || 1)}
                                                            </div>
                                                        </div>
                                                        <div className="flex gap-1 md:gap-2">
                                                            {[-2, -1, 0, 1, 2].map(num => (
                                                                <button 
                                                                    key={num}
                                                                    onClick={() => updateScore(cabin.id, crit, num)}
                                                                    className={`flex-1 py-2 rounded-lg text-white font-bold transition-all ${getScoreColor(num)} ${cabin.scores[crit] === num ? 'ring-4 ring-slate-300 scale-105 z-10' : 'opacity-40'}`}
                                                                >
                                                                    {num > 0 ? `+${num}` : num}
                                                                </button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CabinScorer />);
    </script>
</body>
</html>
